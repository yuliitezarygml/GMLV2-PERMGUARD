# SWA V2 с интеграцией PermGuard

Продвинутое Flask веб-приложение с интегрированной системой авторизации PermGuard для мониторинга трафика в реальном времени и контроля доступа.

## 🚀 Обзор проекта

Этот проект объединяет Flask веб-приложение (SWA V2) с сервером авторизации PermGuard для обеспечения:
- Мониторинга веб-трафика в реальном времени
- Контроля доступа на основе авторизации
- Системы двойного консольного мониторинга
- Админ-панели для аналитики трафика

## 📋 Содержание

- [Архитектура](#-архитектура)
- [Интеграция PermGuard](#-интеграция-permguard)
- [Функции](#-функции)
- [Установка](#-установка)
- [Использование](#-использование)
- [API Эндпоинты](#-api-эндпоинты)
- [Мониторинг](#-мониторинг)
- [Конфигурация](#-конфигурация)

## 🏗️ Архитектура

```
┌─────────────────────────────────────────────────────────────┐
│                    SWA V2 Flask Приложение                 │
├─────────────────────────────────────────────────────────────┤
│  ┌─────────────────┐    ┌─────────────────────────────────┐ │
│  │   Веб Маршруты  │    │      Модуль PermGuard Auth      │ │
│  │                 │◄──►│                                 │ │
│  │ - Главная       │    │ - Мониторинг трафика            │ │
│  │ - Админ панель  │    │ - Проверки авторизации          │ │
│  │ - Список игр    │    │ - Логирование в реальном времени│ │
│  └─────────────────┘    └─────────────────────────────────┘ │
│                                      │                       │
├──────────────────────────────────────┼───────────────────────┤
│                                      ▼                       │
│  ┌─────────────────────────────────────────────────────────┐ │
│  │             Монитор трафика                             │ │
│  │ - Мониторинг логов в реальном времени                   │ │
│  │ - Цветной вывод в консоли                               │ │
│  │ - Отображение статистики                                │ │
│  └─────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────┘
                                      │
                                      ▼
                    ┌─────────────────────────────────┐
                    │        PermGuard Сервер        │
                    │      (Docker Контейнер)        │
                    │                                 │
                    │ - Движок авторизации            │
                    │ - Хранилище политик             │
                    │ - Управление рабочими областями │
                    │ - Порты: 9091, 9092, 9094      │
                    └─────────────────────────────────┘
```

## 🛡️ Интеграция PermGuard

### Что такое PermGuard?

PermGuard - это современный, **открытый провайдер авторизации**, который реализует принципы **Zero Trust авторизации**. Он разработан как централизованная система управления политиками, которая непрерывно проверяет каждый запрос доступа в ваших приложениях.

#### 🔐 Zero Trust Авторизация

PermGuard гарантирует, что **каждый запрос доступа непрерывно проверяется**, будь то:
- API эндпоинты
- Асинхронные сообщения
- WebSocket соединения
- Коммуникация микросервисов
- Доступ к базе данных

#### 🌍 Ключевые концепции PermGuard

**Bring Your Own Identity (BYOI)**: PermGuard разделяет авторизацию и аутентификацию, позволяя использовать любого провайдера идентичности, сохраняя централизованный контроль авторизации.

**Политика как код**: Определение политик доступа с использованием декларативных языков, таких как Cedar, что обеспечивает контроль версий, тестирование и автоматизированное развертывание правил авторизации.

**Облачно-нативный дизайн**: Создан для современных облачных сред с поддержкой:
- Мультитенантных архитектур
- Edge computing
- Развертывания Kubernetes
- Контейнерной оркестрации

**Языково-агностический**: Работает с любым языком программирования через REST API и нативные SDK для Python, Go, Java, Node.js и .NET Core.

#### 🏗️ Компоненты архитектуры PermGuard

**Зоны**: Логические группировки, которые организуют ваши авторизационные ресурсы и политики.

**Реестры (Ledgers)**: Репозитории с контролем версий, которые хранят ваши конфигурации авторизации.

**Манифесты**: Декларации, которые определяют структуру и взаимосвязи ваших разрешений.

**Схемы**: Шаблоны, которые валидируют и структурируют ваши авторизационные данные.

**Политики**: Правила, написанные на языках политик (таких как Cedar), которые определяют, кто может получить доступ к каким ресурсам.

**Разрешения**: Фактические права доступа, предоставляемые принципалам на основе оценки политик.

PermGuard - это комплексный, облачно-нативный сервер авторизации, разработанный для современных приложений. Он обеспечивает централизованное управление политиками и принятие решений об авторизации в реальном времени для безопасного контроля доступа.

#### 🔐 Основные возможности PermGuard

**Движок авторизации:**
- **Контроль доступа на основе политик (PBAC)**: Определение сложных правил доступа с помощью политик
- **Контроль доступа на основе атрибутов (ABAC)**: Учет атрибутов пользователя, свойств ресурса и контекста
- **Контроль доступа на основе ролей (RBAC)**: Традиционные разрешения на основе ролей
- **Принятие решений в реальном времени**: Ответы авторизации менее миллисекунды
- **Архитектура нулевого доверия**: Каждый запрос требует явной авторизации

**Управление политиками:**
- **Декларативные политики**: Написание политик в удобочитаемом формате
- **Версионирование политик**: Отслеживание и управление изменениями политик
- **Тестирование политик**: Тестирование политик перед развертыванием
- **Симуляция политик**: Предварительный просмотр результатов авторизации
- **Динамические обновления политик**: Изменение политик без перезапуска системы

**Мультитенантность и рабочие области:**
- **Изоляция рабочих областей**: Отдельные среды для разных команд/проектов
- **Управление арендаторами**: Поддержка нескольких организаций
- **Пространства имен ресурсов**: Организация ресурсов по рабочим областям
- **Межобластные политики**: Совместное использование политик между рабочими областями при необходимости

**Аудит и соответствие:**
- **Полный аудиторский след**: Логирование каждого решения об авторизации
- **Отчеты о соответствии**: Генерация отчетов для регулятивных требований
- **Обоснование решений**: Понимание, почему доступ был предоставлен/отклонен
- **Линейность данных**: Отслеживание паттернов доступа к данным
- **Криминалистический анализ**: Расследование инцидентов безопасности

**Производительность и масштабируемость:**
- **Распределенная архитектура**: Горизонтальное масштабирование через несколько узлов
- **Система кэширования**: Кэширование часто используемых политик и решений
- **Балансировка нагрузки**: Эффективное распределение запросов авторизации
- **Высокая доступность**: 99.9%+ время работы с резервированием
- **Глобальное развертывание**: Размещение рядом с вашими приложениями по всему миру

**Возможности интеграции:**
- **REST API**: Стандартная интеграция на основе HTTP
- **Поддержка gRPC**: Высокопроизводительная коммуникация protocol buffer
- **Библиотеки SDK**: Нативные библиотеки для Python, Go, Java, Node.js, .NET
- **Поддержка Webhook**: Уведомления в реальном времени об изменениях политик
- **OIDC/OAuth2**: Интеграция с провайдерами идентичности
- **LDAP/Active Directory**: Интеграция с корпоративными системами идентичности

**Функции безопасности:**
- **Шифрование end-to-end**: Вся коммуникация зашифрована при передаче
- **Взаимный TLS**: Аутентификация на основе сертификатов
- **Ограничение скорости API**: Предотвращение злоупотреблений и обеспечение доступности
- **Валидация входных данных**: Защита от инъекционных атак
- **Управление секретами**: Безопасная обработка конфиденциальной конфигурации
- **Сканирование уязвимостей**: Регулярные оценки безопасности

#### 🏢 Компоненты архитектуры PermGuard

**Точка принятия политических решений (PDP) - Порт 9094:**
- Оценивает запросы авторизации против политик
- Возвращает решения разрешить/запретить с обоснованием
- Обрабатывает высокообъемный авторизационный трафик
- Обеспечивает оценку политик в реальном времени

**Точка администрирования политик (PAP) - Порт 9092:**
- Управляет созданием, обновлением и удалением политик
- Обеспечивает валидацию и тестирование политик
- Обрабатывает версионирование и откат политик
- Предлагает шаблоны и примеры политик

**Точка информации о политиках (PIP) - Порт 9091:**
- Извлекает атрибуты для решений об авторизации
- Интегрируется с внешними источниками данных
- Кэширует часто используемые атрибуты
- Обеспечивает сопоставление и трансформацию атрибутов

**API управления:**
- Управление рабочими областями и арендаторами
- Администрирование пользователей и ролей
- Мониторинг системы и проверки работоспособности
- Управление конфигурацией

#### 🔄 Поток авторизации PermGuard

```
1. Запрос приложения
   ↓
2. Извлечение контекста авторизации
   (Субъект, Ресурс, Действие, Среда)
   ↓
3. Отправка в PermGuard PDP (Порт 9094)
   ↓
4. Движок оценки политик
   - Получение применимых политик
   - Оценка против контекста запроса
   - Учет атрибутов и ролей пользователя
   - Применение условий среды
   ↓
5. Решение об авторизации
   - Решение Разрешить/Запретить
   - Обоснование и контекст
   - Запись в аудиторский лог
   ↓
6. Ответ приложению
   ↓
7. Приложение применяет решение
```

#### 📊 Случаи использования PermGuard

**Безопасность приложений:**
- Защита API эндпоинтов
- Авторизация микросервисов
- Контроль доступа к базе данных
- Разрешения файловой системы
- Видимость компонентов UI

**Корпоративный контроль доступа:**
- Доступ сотрудников к ресурсам
- Защита данных клиентов
- Мультитенантные SaaS приложения
- B2B доступ партнеров
- Системы управления поставщиками

**Соответствие и управление:**
- Контроль доступа к данным GDPR
- Защита финансовых данных SOX
- Медицинские записи HIPAA
- Безопасность платежных данных PCI DSS
- Отраслевые регулятивные требования

**DevOps и инфраструктура:**
- Безопасность CI/CD пайплайнов
- Доступ к инфраструктурным ресурсам
- Безопасность контейнерной оркестрации
- Управление облачными ресурсами
- Изоляция среды разработки

#### 🎯 Преимущества PermGuard

**Для разработчиков:**
- Простая интеграция API
- Богатые SDK и документация
- Инструменты тестирования политик
- Поддержка локальной разработки
- Горячая перезагрузка политик

**Для команд безопасности:**
- Централизованное управление политиками
- Комплексные аудиторские следы
- Детальный контроль доступа
- Обнаружение угроз в реальном времени
- Автоматизация соответствия

**Для операций:**
- Высокая доступность и масштабируемость
- Мониторинг производительности
- Автоматизированное развертывание
- Поддержка множественных сред
- Возможности аварийного восстановления

**Для бизнеса:**
- Быстрое время выхода на рынок
- Снижение рисков безопасности
- Автоматизация соответствия
- Экономичное масштабирование
- Независимость от поставщиков

#### 🚀 Продвинутые возможности PermGuard

**Язык и выражения политик:**
- **Язык политик Cedar**: Открытый язык политик от Amazon
- **Политики на основе JSON**: Структурированные определения политик
- **Условная логика**: Сложные правила if-then-else
- **Интерполяция атрибутов**: Динамическая оценка политик
- **Временные политики**: Временные предоставления доступа
- **Правила на основе геолокации**: Контроль доступа по местоположению

**Интеграция данных и контекст:**
- **Внешние источники данных**: Интеграция с базами данных, API, LDAP
- **Получение атрибутов в реальном времени**: Динамические атрибуты пользователя/ресурса
- **Контекстно-зависимые решения**: Учет времени, местоположения, устройства, сети
- **Авторизация на основе рисков**: Адаптивный доступ на основе оценок рисков
- **Интеграция машинного обучения**: AI-управляемые решения об авторизации
- **Поведенческая аналитика**: Обнаружение аномальных паттернов доступа

**Опыт разработчика:**
- **Игровая площадка политик**: Интерактивная среда тестирования политик
- **Визуальный конструктор политик**: Создание политик перетаскиванием
- **Шаблоны политик**: Предварительно созданные политики для общих сценариев
- **Режим отладки**: Пошаговая оценка политик
- **Профилирование производительности**: Оптимизация производительности политик
- **Мок-тестирование**: Тестирование политик с синтетическими данными

**Корпоративные функции:**
- **Многорегиональное развертывание**: Глобальное распространение политик
- **Аварийное восстановление**: Автоматическое переключение и резервное копирование
- **Blue-Green развертывание**: Обновления политик без простоев
- **A/B тестирование**: Постепенное развертывание политик
- **Canary релизы**: Тестирование политик с подмножеством трафика
- **Возможности отката**: Мгновенный откат политик

**Мониторинг и наблюдаемость:**
- **Дашборды в реальном времени**: Метрики производительности политик
- **Системы оповещений**: Уведомления о нарушениях политик
- **Кастомные метрики**: Мониторинг для конкретных приложений
- **Распределенная трассировка**: Отслеживание запросов через сервисы
- **Агрегация логов**: Централизованное логирование и анализ
- **Обнаружение аномалий**: Выявление необычных паттернов доступа

**Соответствие и управление:**
- **Анализ влияния политик**: Понимание изменений политик
- **Ревью доступа**: Периодическая сертификация доступа
- **Разделение обязанностей**: Предотвращение конфликтующих разрешений
- **Классификация данных**: Защита категорий чувствительных данных
- **Контроль конфиденциальности**: Функции соответствия GDPR, CCPA
- **Политики хранения**: Автоматическое управление жизненным циклом данных

#### 🌍 PermGuard в продакшене

**Производительность масштаба Netflix:**
- Обработка 100,000+ запросов в секунду
- Латентность авторизации менее 5мс
- SLA доступности 99.99%
- Глобальное распространение как CDN
- Автоматическое масштабирование по требованию

**Дизайн с приоритетом безопасности:**
- Нулевое доверие по умолчанию
- Принцип наименьших привилегий
- Защита в глубину
- Непрерывный мониторинг соответствия
- Интеграция threat intelligence

**Примеры политик из реального мира:**

**Платформа электронной коммерции:**
```yaml
# Клиент может просматривать свои собственные заказы
policy CustomerOrderAccess {
  permit(
    principal == Customer::"${context.user_id}",
    action == Action::"view",
    resource == Order::"*"
  )
  when { resource.customer_id == principal.id };
}
```

**Система здравоохранения:**
```yaml
# Врач может получать доступ к записям пациентов в своем отделении
policy DoctorPatientAccess {
  permit(
    principal in Role::"Doctor",
    action == Action::"read",
    resource == PatientRecord::"*"
  )
  when {
    principal.department == resource.department &&
    context.time >= "09:00" && context.time <= "17:00"
  };
}
```

**Финансовые услуги:**
```yaml
# Высокостоимостные транзакции требуют дополнительного одобрения
policy HighValueTransaction {
  forbid(
    principal in Role::"Trader",
    action == Action::"execute",
    resource == Transaction::"*"
  )
  when {
    resource.amount > 1000000 &&
    !principal.hasApproval
  };
}
```

#### 🔗 Интеграция экосистемы PermGuard

**Облачные платформы:**
- **AWS**: IAM, Lambda, API Gateway, S3, RDS
- **Azure**: Active Directory, Key Vault, Application Gateway
- **Google Cloud**: Cloud IAM, Identity Platform, Cloud Run
- **Kubernetes**: RBAC, admission controllers, service mesh
- **Docker**: Авторизация на уровне контейнера и секреты

**Фреймворки разработки:**
- **Spring Security**: Java/Spring Boot middleware
- **Express.js**: Node.js авторизационный middleware
- **Django/Flask**: Python веб-фреймворк декораторы
- **ASP.NET Core**: .NET authorization handlers
- **Ruby on Rails**: Авторизационные gems и фильтры

**Системы баз данных:**
- **PostgreSQL**: Интеграция row-level security
- **MongoDB**: Разрешения на уровне документа
- **Redis**: Контроль доступа на основе ключей
- **Elasticsearch**: Безопасность индекса и документа
- **MySQL**: Разрешения на уровне таблицы и столбца

**API Gateway:**
- **Kong**: Авторизация на основе плагинов
- **Ambassador**: Kubernetes-нативный API gateway
- **Istio**: Политики безопасности service mesh
- **Traefik**: Динамический авторизационный middleware
- **NGINX**: Фильтрация запросов на основе модулей

#### 📊 Бенчмарки производительности PermGuard

**Метрики латентности:**
- **Решение об авторизации**: < 5мс (99-й процентиль)
- **Оценка политики**: < 1мс в среднем
- **Разрешение атрибутов**: < 100мс для внешних поисков
- **Ответ из кэша**: < 0.1мс для кэшированных решений
- **Время переключения**: < 30 секунд для аварийного восстановления

**Возможности пропускной способности:**
- **Пиковый RPS**: 100,000+ запросов в секунду
- **Одновременные пользователи**: Тестировано с 1М+ активных пользователей
- **Сложность политик**: 10,000+ политик на рабочую область
- **Масштаб рабочих областей**: 1,000+ рабочих областей на развертывание
- **Глобальное распространение**: Латентность менее 100мс по всему миру

**Использование ресурсов:**
- **Использование памяти**: < 500МБ на экземпляр авторизации
- **Использование CPU**: < 10% при нормальной нагрузке
- **Хранилище**: Минимальные требования к хранению политик
- **Сеть**: Оптимизированные протоколы gRPC и HTTP/2
- **Процент попаданий в кэш**: 95%+ для частых решений

#### 🛠️ Инструменты разработки PermGuard

**Разработка политик:**
- **Policy Studio**: Визуальный редактор и отладчик политик
- **Фреймворк тестирования**: Автоматизированный набор тестов политик
- **Движок симуляции**: Предварительный просмотр влияния политик перед развертыванием
- **Контроль версий**: Git-управляемое управление политиками
- **Интеграция CI/CD**: Автоматизированные пайплайны развертывания политик

**Мониторинг и аналитика:**
- **Дашборды в реальном времени**: Метрики и тренды авторизации
- **Кастомные оповещения**: Настраиваемые уведомления о нарушениях политик
- **Аналитика производительности**: Оптимизация производительности политик
- **Аудиторские отчеты**: Отчеты о соответствии и управлении
- **Аналитика поведения пользователей**: Анализ паттернов доступа

### Как PermGuard работает в этом проекте

1. **Инициализация**
   ```python
   # Клиент PermGuard подключается к серверу на localhost:9094
   endpoint = AZEndpoint(endpoint="localhost", port=9094)
   ```

2. **Поток авторизации**
   ```
   HTTP Запрос → Flask App → Модуль PermGuard Auth → Сервер PermGuard
        │                                                      │
        ▼                                                      ▼
   Трафик залогирован ← Ответ ← Решение об авторизации ← Проверка политики
   ```

3. **Интеграция компонентов**
   - **AZClient**: Обрабатывает коммуникацию с сервером PermGuard
   - **AZRequest**: Запрос авторизации с субъектом, ресурсом, действием
   - **AZResponse**: Решение об авторизации с контекстом и обоснованием

### Конфигурация PermGuard

Система использует следующие настройки PermGuard:
```python
PERMGUARD_CONFIG = {
    'endpoint': 'localhost',
    'port': 9094,
    'workspace_id': '875986860059',
    'policy_store_id': '4b16807f1d724a118ac52c295f9794dd',
    'fallback_allowed': True
}
```

## ✨ Функции

### 🌐 Мониторинг веб-трафика
- **Автоматическое отслеживание запросов**: Каждый HTTP запрос перехватывается и логируется
- **Подробные метрики**: Время ответа, коды статуса, информация о пользователе, IP адреса
- **Обновления в реальном времени**: Живой мониторинг через консольный и веб-интерфейс

### 🔐 Система авторизации
- **Интеграция PermGuard**: Реальные решения об авторизации от сервера PermGuard
- **Режим отката**: Продолжает работу, если PermGuard недоступен
- **Контроль доступа администратора**: Специальная обработка административных маршрутов

### 📊 Система двойной консоли
- **Консоль 1**: Сервер Flask приложения с интегрированным логированием
- **Консоль 2**: Монитор PermGuard в реальном времени с цветным выводом и статистикой

### 🎛️ Админ панель
- **Дашборд трафика**: `/admin/traffic` - Визуализация трафика в реальном времени
- **API статистики**: RESTful эндпоинты для данных о трафике
- **Интерактивные фильтры**: Фильтрация по дате, статусу, пользователю и т.д.

## 🛠️ Установка

### Требования

1. **Python 3.11+**
2. **PermGuard Docker Контейнер** (работающий на портах 9091, 9092, 9094)
3. **Требуемые Python пакеты**:
   ```bash
   pip install flask permguard requests
   ```

### Шаги установки

1. **Клонировать/Извлечь проект**
   ```bash
   cd d:\465645456456456\falsk
   ```

2. **Установить PermGuard Python Client**
   ```bash
   pip install permguard
   ```

3. **Запустить PermGuard Docker Контейнер**
   ```bash
   # Ваш PermGuard контейнер должен работать на:
   # - Порт 9091: Management API
   # - Порт 9092: Admin API
   # - Порт 9094: Authorization API (PDP)
   ```

4. **Настроить параметры**
   - Отредактируйте `swaweb/permguard_auth.py` при необходимости
   - Обновите workspace и policy store ID если они отличаются

## 🚀 Использование

### Метод 1: Запуск двойной консоли (Рекомендуется)

```bash
cd swaweb
python launcher.py
```

Это автоматически запускает:
- **Окно 1**: Flask сервер (http://localhost:5001)
- **Окно 2**: Монитор PermGuard в реальном времени

### Метод 2: Ручной запуск

**Терминал 1 - Flask Сервер:**
```bash
cd swaweb
python app.py
```

**Терминал 2 - PermGuard Монитор:**
```bash
cd swaweb
python permguard_monitor.py
```

### Доступ к приложению

- **Основное приложение**: http://localhost:5001
- **Админ панель**: http://localhost:5001/admin/traffic
- **API**: http://localhost:5001/api/admin/traffic/stats

## 📡 API Эндпоинты

### API мониторинга трафика

#### GET `/api/admin/traffic/stats`
Возвращает статистику трафика
```json
{
  "total_requests": 150,
  "successful_requests": 145,
  "failed_requests": 5,
  "average_response_time": 45.2,
  "requests_per_minute": 12.5
}
```

#### GET `/api/admin/traffic/logs`
Возвращает последние логи трафика
```json
{
  "logs": [
    {
      "id": "traffic_123_20250913_145052",
      "timestamp": "2025-09-13T14:50:52",
      "method": "GET",
      "path": "/",
      "status_code": 200,
      "duration": 334.85,
      "user": "anonymous",
      "ip": "127.0.0.1"
    }
  ]
}
```

#### GET `/api/admin/traffic/demo`
Возвращает демо-данные для тестирования

## 📊 Мониторинг

### Функции консольного монитора

Монитор в реальном времени (`permguard_monitor.py`) предоставляет:

```
================================================================================
  PERMGUARD REAL-TIME MONITOR
================================================================================
Started at: 2025-09-13 14:50:54
Log file: permguard_detailed.log
Monitoring... (Press Ctrl+C to stop)
================================================================================

LOG STATISTICS:
   Total lines: 56
   Auth requests: 0
   ✅ Allowed: 5
   [X] Denied: 0
   🌐 Traffic logs: 3
   ⚠️  Warnings: 4
   💥 Errors: 4
```

### Структура лог файла

Система создает подробные логи в `permguard_detailed.log`:
```
2025-09-13 14:50:52 [INFO] ✅ PermGuard client initialized successfully
2025-09-13 14:50:52 [DEBUG] 🌐 TRAFFIC: GET / -> 200 (334.85ms) user: anonymous IP: 127.0.0.1
2025-09-13 14:50:52 [INFO] 🔐 ADMIN ACCESS: anonymous -> GET /admin/traffic [302] (0.0ms)
```

### Индикаторы мониторинга трафика

- **🌐 TRAFFIC**: Общий веб-трафик
- **🔐 ADMIN ACCESS**: Попытки доступа к админ панели
- **✅ ALLOWED**: Успешная авторизация
- **❌ DENIED**: Неудачная авторизация
- **⚠️ WARNING**: Системные предупреждения
- **💥 ERROR**: Условия ошибок

## ⚙️ Конфигурация

### Настройки PermGuard

Расположены в `swaweb/permguard_auth.py`:

```python
PERMGUARD_CONFIG = {
    'endpoint': 'localhost',      # Хост сервера PermGuard
    'port': 9094,                # Порт PermGuard PDP
    'workspace_id': '875986860059',  # ID вашей рабочей области
    'policy_store_id': '4b16807f1d724a118ac52c295f9794dd',  # ID хранилища политик
    'fallback_allowed': True,     # Разрешить откат если PermGuard недоступен
    'log_traffic': True,         # Включить логирование трафика
    'log_level': 'DEBUG'         # Уровень логирования
}
```

### Настройки Flask приложения

Расположены в `swaweb/app.py`:

```python
# Конфигурация сервера
HOST = '0.0.0.0'
PORT = 5001
DEBUG = False

# Интеграция PermGuard
ENABLE_PERMGUARD = True
TRAFFIC_MONITORING = True
```

## 🔧 Устранение неполадок

### Частые проблемы

1. **Сбой подключения PermGuard**
   ```
   ❌ Failed to connect to PermGuard: PermGuard client not available
   ```
   - **Решение**: Убедитесь, что Docker контейнер PermGuard работает на порту 9094
   - Проверьте статус Docker контейнера: `docker ps`

2. **Отсутствует модель авторизации**
   ```
   Bad Request: missing authorization model in request
   ```
   - **Решение**: Это нормально - PermGuard подключен, но нужна конфигурация политик
   - Система продолжает работу в режиме отката

3. **Ошибки кодировки Unicode** (Windows)
   ```
   UnicodeEncodeError: 'charmap' codec can't encode
   ```
   - **Решение**: Уже исправлено - эмодзи удалены из консольного вывода для совместимости с Windows

### Режим отладки

Включите подробную отладку, изменив `permguard_auth.py`:
```python
permguard_logger.setLevel(logging.DEBUG)
```

## 📝 Структура проекта

```
falsk/
├── README.md                    # Этот файл (английский)
├── README_RU.md                 # Этот файл (русский)
├── swaweb/
│   ├── app.py                  # Основное Flask приложение
│   ├── permguard_auth.py       # Модуль интеграции PermGuard
│   ├── permguard_monitor.py    # Монитор логов в реальном времени
│   ├── launcher.py             # Запуск двойной консоли
│   ├── permguard_detailed.log  # Логи PermGuard
│   ├── templates/
│   │   └── admin/
│   │       └── traffic.html    # Дашборд мониторинга трафика
│   └── static/                 # CSS, JS, изображения
└── requirements.txt            # Python зависимости (если существует)
```

## 🔗 Связанная документация

### 📚 Документация PermGuard

**Начало работы:**
- **Парадигма PermGuard**: https://community.permguard.com/docs/0.0.x/getting-started/permguard-paradigm/
- **Зачем нужен PermGuard**: https://community.permguard.com/docs/0.0.x/getting-started/why-permguard/
- **Готовность к Zero Trust**: https://community.permguard.com/docs/0.0.x/getting-started/zero-trust-ready/
- **Установка и настройка**: https://community.permguard.com/docs/0.0.x/getting-started/install-bootstrap/
- **Основная терминология**: https://community.permguard.com/docs/0.0.x/getting-started/essential-terminology/

**Основные концепции:**
- **Аутентификация против авторизации**: https://community.permguard.com/docs/0.0.x/concepts/authn-authz/authn-vs-authz/
- **Зоны**: https://community.permguard.com/docs/0.0.x/concepts/zones/zones/
- **Реестры (Ledgers)**: https://community.permguard.com/docs/0.0.x/concepts/permissions/ledgers/
- **Манифесты**: https://community.permguard.com/docs/0.0.x/concepts/permissions/manifests/
- **Схемы**: https://community.permguard.com/docs/0.0.x/concepts/permissions/schemas/
- **Политики**: https://community.permguard.com/docs/0.0.x/concepts/permissions/policies/
- **Разрешения**: https://community.permguard.com/docs/0.0.x/concepts/permissions/permissions/
- **Применение политик**: https://community.permguard.com/docs/0.0.x/concepts/permissions/enforcement/
- **Пути ресурсов**: https://community.permguard.com/docs/0.0.x/concepts/authz-server/resource-pathing/
- **Облачные паттерны**: https://community.permguard.com/docs/0.0.x/concepts/patterns/cloud-native-patterns/

**Политика как код:**
- **API авторизации**: https://community.permguard.com/docs/0.0.x/policy-as-code/authz-api/
- **Языки политик**: https://community.permguard.com/docs/0.0.x/policy-as-code/policy-languages/
- **Язык политик Cedar**: https://community.permguard.com/docs/0.0.x/policy-as-code/cedar-policy-language/

**SDK и интеграция:**
- **Python SDK**: https://community.permguard.com/docs/0.0.x/sdks/python/
- **Go SDK**: https://community.permguard.com/docs/0.0.x/sdks/go/
- **Node.js SDK**: https://community.permguard.com/docs/0.0.x/sdks/node/
- **Java SDK**: https://community.permguard.com/docs/0.0.x/sdks/java/
- **.NET Core SDK**: https://community.permguard.com/docs/0.0.x/sdks/dotnet-core/

**CodeOps и DevOps:**
- **Управление рабочими областями**: https://community.permguard.com/docs/0.0.x/codeops/workspace-mgmt/
- **Управление реестрами**: https://community.permguard.com/docs/0.0.x/codeops/ledger-mgmt/
- **Планирование и применение**: https://community.permguard.com/docs/0.0.x/codeops/plan-apply/
- **Среды развертывания**: https://community.permguard.com/docs/0.0.x/devops/environments/
- **Конфигурация сервера авторизации**: https://community.permguard.com/docs/0.0.x/devops/authz-server-config/

**Архитектура и ядро:**
- **Обзор архитектуры**: https://community.permguard.com/docs/0.0.x/core-stack/architecture/
- **Движки политик**: https://community.permguard.com/docs/0.0.x/core-stack/policy-engines/
- **Валидация данных**: https://community.permguard.com/docs/0.0.x/core-stack/data-validation/

### 🌐 Официальные ресурсы

- **Веб-сайт PermGuard**: https://www.permguard.com/
- **PermGuard GitHub**: https://github.com/permguard/permguard
- **Документация сообщества**: https://community.permguard.com/docs/
- **Блог PermGuard**: https://www.permguard.com/blog/

### 🔧 Ресурсы для разработки

- **Документация Flask**: https://flask.palletsprojects.com/
- **Документация Docker**: https://docs.docker.com/
- **Документация Python psutil**: https://psutil.readthedocs.io/

## 📧 Поддержка

По вопросам и проблемам:
1. Проверьте раздел устранения неполадок выше
2. Просмотрите логи PermGuard в `permguard_detailed.log`
3. Убедитесь, что все требования выполнены
4. Проверьте, что Docker контейнер PermGuard работает

---

**Создано**: Сентябрь 2025
**Последнее обновление**: 13 сентября 2025
**Версия**: 2.0 с интеграцией PermGuard